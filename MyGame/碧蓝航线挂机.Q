[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=cbf0adc5-ece5-4ef1-8fdd-19d535f8969f
Description=碧蓝航线挂机
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=2
QUI=
[Relative]
SetupOCXFile=
[Comment]

[Attachment]
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


[Script]
'分辨率为800*600
'************************初始化区域************************* 
'常量定义
'坐标脚本路径
Const COORDINATES_FOLDER_PATH = "C:\QM_Data\碧蓝航线\坐标"

'句柄操作
Hwnd = Plugin.Window.MousePoint()
sRect = Plugin.Window.GetClientRect(Hwnd)  
Dim clientCoordinates	
clientCoordinates = Split(sRect, "|")		'将游戏窗口左上角坐标作为游戏窗口的起始坐标
'将字符串转换为长整型(Long类型,对于坐标来说，参数只能是整型，所以需要转换)
gL = Clng(clientCoordinates(0))
gT = Clng(clientCoordinates(1))  
gR = Clng(clientCoordinates(2))
gB = Clng(clientCoordinates(3))
'************************初始化区域*************************




'************************* 运行区域 ***************************



Const TIMES = 1
'************************** 运行区域 **************************

Sub ShuaShuaShua(chapter, fightId, iTimes)
    //Call ChooseChapter(1)
    For TIMES
    
        Call ChooseFight("关卡01-04")

        Do
            TracePrint "DDDD"
            If GameFindPic(885, 615, 980, 650, "Attachment:\战斗选择界面.bmp", 0.7) Then 
                Call BeginFight("起始坐标01-04", True)
                Delay 1000
            Else 
                Exit Do
            End If
        Loop
    Next 
End Sub
'**************************函数声明区域*******************************
'子程
'全选有文本的内容

'选择章节，参数为章节id
Sub ChooseChapter(chapterId)
    TracePrint "FFFFF"
	
    For 8
        Call GameClickByConfig("选择关卡", "上一章", 0, 0)
    Next
    Delay 500
    For Int(chapterId) - 1
        Call GameClickByConfig("选择关卡", "下一章", 0, 0)
    Next
    Delay 1500
End Sub

'选择对应战斗，参数为战斗名
Sub ChooseFight(fightName)
    Call GameClickByConfig("选择关卡", fightName, 0, 0)
    Call GameClickByConfig("选择关卡", "前往关卡", 0, 0)
    Call GameClickByConfig("选择关卡", "确认前往关卡", 0, 0)
End Sub

'开始战斗，需要先确定起始坐标，参数为起始坐标


Sub BeginFight(starPoint, isSkipAmbush)
    '是否整个关卡攻略完成
    If Not GameFindPic(885, 615, 980, 650, "Attachment:\战斗选择界面.bmp", 0.7) Then 
        Call CheckAmbush(isSkipAmbush)
        If Not GameFindPic(885, 615, 980, 650, "Attachment:\战斗选择界面.bmp", 0.7) Then 
            Exit Sub
        End If
    End If

    Call GameClickByConfig("选择关卡", starPoint, 0, 0)
	
    Do
        '是否被空袭
        Call CheckAmbush(isSkipAmbush)
        
        FindPic gL + 125, gT + 140, gL + 940, gT + 575, "Attachment:\enemy0.bmp", 0.3, intX, intY
        If intX > 0 And intY > 0 Then 
            Call MoveAndClick(intX, intY, 200, 8000)
            Call CheckAmbush(isSkipAmbush)
            If GameFindPic(725, 555, 960, 640, "Attachment:\fight_button.bmp", 0.7) Then 
                Call GameClickByConfig("战斗", "开始战斗", 0, 0)
                Call Fight()
            End If
            Exit Do
        End If
    Loop
End Sub

'检查是否被空袭，并选择是否迎击
Sub CheckAmbush(isSkipAmbush)
    TracePrint "突发战斗"
    If GameFindPic(405, 375, 585, 425, "Attachment:\迎击.bmp", 0.5) Then 
        If isSkipAmbush Then 
            Call GameClickByConfig("战斗", "规避", 0, 0)
        Else 
            Call GameClickByConfig("战斗", "迎击", 0, 0)
            Call GameClickByConfig("战斗", "开始战斗", 0, 0)
            Call Fight()
            //Exit Sub
        End If
    End If	
End Sub




Sub Fight()
    Dim iParm
    iParm = 4
    Do
        Call MoveAndClick(gL + 935, gT + 255, 200, 1800)
        iParm = iParm + 1
        If (iParm mod 4) = 0 Then 
            If GameFindPic(820, 565, 950, 600, "Attachment:\战斗结束确认.bmp", 0.5) Then 
                Call GameClickByConfig("战斗", "确认奖励", 0, 0)
                Exit Sub
            End If
        End If
    Loop
End Sub


Sub MoveAndClick(x, y, moveDelay, clickDealy)
    MoveTo x, y
    Delay moveDelay
    LeftClick 1
    Delay clickDealy
End Sub

'根据传进来的系统和作用点击坐标，systemName为系统名，forDoWhat为作用，moveDelay为移动后的颜色，clickDealy为点击后的延时，调用函数时2者默认填0，函数会根据表去确定延时，也可以随时更改
Sub GameClickByConfig(systemName, forDoWhat, moveDelay, clickDealy)
    Dim coords, coordArr 
    coords = GetCoordinates(systemName, forDoWhat)
    If coords = "" Then 
        TracePrint "没有对应的按钮配置信息: systemName = " & systemName & " ,  forDoWhat = " & forDoWhat
        EndScript
    End If
    
    coordArr = Split(coords, "|")
    
    '如果延时传0，则替换表内的默认延时
    If moveDelay = 0 Then 
        moveDelay = coordArr(2)
    End If
    If clickDealy = 0 Then 
        clickDealy = coordArr(3)
    End If
    Call GameMoveAndClick(coordArr(0), coordArr(1), moveDelay, clickDealy)
End Sub

'获取对应系统和作用按钮的x，y坐标，移动延时，点击延时（返回以"|"连接的字符串），无则返回空字符串，systemName为系统名，forDoWhat为作用
Function GetCoordinates(systemName, forDoWhat)
    Dim text, textArr
    text = GetTxtString(COORDINATES_FOLDER_PATH & "\" & systemName & ".txt")
    textArr = Split(text, "|")
    Dim i
    For i = 0 To UBound(textArr) - 1 Step 5
        If forDoWhat = textArr(i + 4) Then 
            GetCoordinates = textArr(i) & "|" & textArr(i + 1) & "|" & textArr(i + 2) & "|" & textArr(i + 3)
            Exit Function
        End If
    Next
    GetCoordinates = ""
End Function


'循环输入指令，会读取目标路径txt文件的数据依次输入进行测试,参数为指令文件路径，必须为txt文本, orderStarKwd为开始读取的文本内容
Sub InputOrderFormTxt(orderPath, orderStarKwd)
    Dim tempText, orderArr
    tempText = GetTxtString(orderPath)
    If tempText = "" Then 
        MessageBox "Sub [InputOrderFormTxt(orderPath, orderStarKwd)] error: 读取的文本错误或文本内没有内容"
        EndScript
    End If
    orderArr = Split(tempText, "|")
    Dim i, starIndex
    For i = 0 To ( Ubound( orderArr ))
        If orderArr(i) = orderStarKwd Then 
            starIndex = i
            Exit For
        End If
    Next

    If i >= UBound(orderArr) Then 
        TracePrint "无效的起始指令，请重新输入！"
        ExitScript 
    Else 
        For i = starIndex To (Ubound(orderArr) - 1)
            InputOrder(orderArr(i))
        Next
    End If
End Sub

'相对于游戏窗口坐标进行点击，参数分别为游戏窗口x轴坐标，y轴坐标，点击后的延时
Sub GameMoveAndClick( x, y, moveDelay, clickDelay )
    MoveTo gL + x, gT + y
    Delay moveDelay
    LeftClick 1
    Delay clickDelay
End Sub

'函数 
'获取txt文本内容返回函数调用处，参数为txt文本路径
Function GetTxtString( strPath )
    GetTxtString = Plugin.File.ReadFileEx( strPath )
End Function

Sub WriteInTxt(filePath, wStr)
    Call Plugin.File.WriteFileEx(filePath, wStr)
End Sub

Function ReadFormTxt(filePath)
    ReadFormTxt = Plugin.File.ReadFileEx(filePath)
End Function

Function GameFindPic(x1, y1, x2, y2, picName, picSim)
    FindPic gL + x1, gT + y1, gL + x2, gT + y2, picName, picSim, intX, intY
    If intX > 0 And intY > 0 Then
        GameFindPic = True
    Else 
        GameFindPic = False
    End If
End Function

'**************************函数声明区域*******************************